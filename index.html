<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trace & Learn</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Andika&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #ff6b6b;
        --secondary: #4ecdc4;
        --bg: #f7fff7;
        --font-main: "Andika", sans-serif;
      }
      body {
        font-family: var(--font-main);
        background-color: var(--bg);
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 0;
        height: 100vh;
        user-select: none;
        overflow-x: hidden;
      }

      #admin-menu {
        width: 100%;
        background: #e0e0e0;
        padding: 8px;
        display: flex;
        justify-content: center;
        z-index: 10;
      }
      .admin-btn {
        background: #fdfdfd;
        border: 1px solid #bbb;
        padding: 5px 15px;
        cursor: pointer;
        border-radius: 5px;
        font-size: 14px;
      }

      #setup-screen,
      #game-screen,
      #final-screen {
        text-align: center;
        margin-top: 30px;
        width: 100%;
      }
      .hidden {
        display: none !important;
      }

      input {
        padding: 15px;
        font-size: 24px;
        border-radius: 15px;
        border: 3px solid var(--secondary);
        text-align: center;
        font-family: var(--font-main);
      }

      canvas {
        background: white;
        border-radius: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        touch-action: none;
        cursor: crosshair;
        margin-top: 15px;
      }

      .controls {
        display: flex;
        gap: 20px;
        margin-top: 20px;
        justify-content: center;
      }
      .btn-circle {
        width: 85px;
        height: 85px;
        border-radius: 50%;
        border: none;
        color: white;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2);
        font-family: var(--font-main);
        font-size: 18px;
      }
      .btn-clear {
        background-color: var(--primary);
      }
      .btn-next {
        background-color: var(--secondary);
      }

      .comparison-container {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
        padding: 20px;
        position: relative;
        z-index: 5;
      }
      .result-box {
        border: 3px solid #eee;
        padding: 10px;
        background: white;
        border-radius: 15px;
        min-width: 110px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      }
      .big-text {
        font-size: 100px;
        font-weight: bold;
        margin: 0;
        font-family: var(--font-main);
      }

      #message {
        font-size: 32px;
        color: #555;
        min-height: 45px;
      }
      .main-btn {
        padding: 15px 40px;
        font-size: 22px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        font-family: var(--font-main);
        position: relative;
        z-index: 10;
      }

      /* Sticker Styles */
      .sticker {
        position: absolute;
        pointer-events: none;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        border: 4px solid white;
        border-radius: 10px;
        z-index: 1;
      }
    </style>
  </head>
  <body>
    <div id="admin-menu" class="hidden">
      <button class="admin-btn" onclick="restartWithWarning()">
        Start New Word (Restart)
      </button>
    </div>

    <div id="setup-screen">
      <h1>What are we learning?</h1>
      <input
        type="text"
        id="wordInput"
        placeholder="Enter word..."
        maxlength="10"
      />
      <br /><br />
      <button class="main-btn" onclick="startGame()">Go!</button>
    </div>

    <div id="game-screen" class="hidden">
      <div id="message">Trace the letter!</div>
      <canvas id="paintCanvas" width="500" height="500"></canvas>
      <div class="controls">
        <button class="btn-circle btn-clear" onclick="clearCanvas()">
          Erase
        </button>
        <button class="btn-circle btn-next" onclick="skipToNext()">Next</button>
      </div>
    </div>

    <div id="final-screen" class="hidden">
      <h1>Great Job!</h1>
      <div id="comparison-gallery" class="comparison-container"></div>
      <br />
      <button class="main-btn" onclick="resetApp()">Play Again</button>
    </div>

    <script>
      const canvas = document.getElementById("paintCanvas");
      const ctx = canvas.getContext("2d");
      let currentWord = "";
      let currentIndex = 0;
      let isDrawing = false;
      let targetPixels = 0;
      let userDrawings = [];

      function startGame() {
        const input = document.getElementById("wordInput").value;
        if (!input) return;
        currentWord = input;
        currentIndex = 0;
        userDrawings = [];
        document.getElementById("setup-screen").classList.add("hidden");
        document.getElementById("game-screen").classList.remove("hidden");
        document.getElementById("admin-menu").classList.remove("hidden");
        loadLetter();
      }

      function loadLetter() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const letter = currentWord[currentIndex];
        ctx.font = "bold 400px 'Andika'";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillStyle = "#F2F2F2";
        ctx.fillText(letter, canvas.width / 2, canvas.height / 2);
        countTargetPixels();
        document.getElementById("message").innerText =
          `Can you trace "${letter}"?`;
      }

      function countTargetPixels() {
        const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
        targetPixels = 0;
        for (let i = 3; i < data.length; i += 80)
          if (data[i] > 0) targetPixels++;
      }

      canvas.addEventListener("mousedown", startPos);
      canvas.addEventListener("mouseup", endPos);
      canvas.addEventListener("mousemove", draw);
      canvas.addEventListener("touchstart", (e) => {
        e.preventDefault();
        startPos(e.touches[0]);
      });
      canvas.addEventListener("touchend", endPos);
      canvas.addEventListener("touchmove", (e) => {
        e.preventDefault();
        draw(e.touches[0]);
      });

      function startPos(e) {
        isDrawing = true;
        draw(e);
      }
      function endPos() {
        isDrawing = false;
        ctx.beginPath();
        validateTrace();
      }

      function draw(e) {
        if (!isDrawing) return;
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        ctx.lineWidth = 30;
        ctx.lineCap = "round";
        ctx.strokeStyle = "#4ECDC4";
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x, y);
      }

      function validateTrace() {
        const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
        let hits = 0;
        for (let i = 3; i < data.length; i += 80) {
          if (data[i - 2] === 78 && data[i - 1] === 205) hits++;
        }
        if (hits > targetPixels * 0.7) success();
      }

      function success() {
        userDrawings.push(canvas.toDataURL());
        document.getElementById("message").innerText = "Perfect!";
        setTimeout(() => {
          currentIndex++;
          if (currentIndex < currentWord.length) loadLetter();
          else showFinal();
        }, 600);
      }

      function clearCanvas() {
        loadLetter();
      }
      function skipToNext() {
        success();
      }
      function restartWithWarning() {
        if (confirm("Stop this word and start over?")) resetApp();
      }

      function showFinal() {
        document.getElementById("game-screen").classList.add("hidden");
        document.getElementById("admin-menu").classList.add("hidden");
        document.getElementById("final-screen").classList.remove("hidden");

        const gallery = document.getElementById("comparison-gallery");
        gallery.innerHTML = "";
        currentWord.split("").forEach((char, i) => {
          const box = document.createElement("div");
          box.className = "result-box";
          box.innerHTML = `<div class="big-text">${char}</div><hr style="border:1px solid #eee"><img src="${userDrawings[i]}" width="90">`;
          gallery.appendChild(box);
        });

        // Add Random Stickers
        for (let i = 1; i <= 6; i++) {
          const img = document.createElement("img");
          img.src = `${i}.jpg`;
          img.className = "sticker";

          // Random position
          const x = Math.random() * (window.innerWidth - 150);
          const y = Math.random() * (window.innerHeight - 150);
          // Random rotation
          const rotate = Math.random() * 40 - 20;
          // Random size
          const size = 100 + Math.random() * 50;

          img.style.left = `${x}px`;
          img.style.top = `${y}px`;
          img.style.transform = `rotate(${rotate}deg)`;
          img.style.width = `${size}px`;

          document.getElementById("final-screen").appendChild(img);
        }
      }

      function resetApp() {
        document.querySelectorAll(".sticker").forEach((s) => s.remove());
        document.getElementById("setup-screen").classList.remove("hidden");
        document.getElementById("game-screen").classList.add("hidden");
        document.getElementById("final-screen").classList.add("hidden");
        document.getElementById("admin-menu").classList.add("hidden");
        document.getElementById("wordInput").value = "";
      }
    </script>
  </body>
</html>
